{% extends 'base.html.twig' %}

{% set title = 'Zorglux - Inscription à la Communauté' %}
{% set description = "Rejoignez Zorglux, la communauté des passionnés de blogging. Inscrivez-vous maintenant pour accéder à des outils de blogging puissants, des modèles personnalisables et un SEO intégré. Développez votre voix et engagez-vous avec une audience mondiale." %}
{% set logoUrl = 'https://zorglux-bucket.s3.eu-north-1.amazonaws.com/zorglux.webp' %}

{% block canonical %}
    <link rel="canonical" href="{{ absolute_url(path('app_register')) }}">
{% endblock %}

{% block title %}{{ title }}{% endblock %}

{% block meta %}
    <meta name="description" content="{{ description }}">
    <meta name="author" content="Zorglux">
{% endblock %}

{% block meta_og %}
    <meta property="og:title" content="{{ title }}">
    <meta property="og:description" content="{{ description }}">
    <meta property="og:image" content="{{ logoUrl }}">
    <meta property="og:url" content="{{ path('app_register') }}">
    <meta property="og:type" content="website">
{% endblock %}

{% block meta_twitter %}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ title }}">
    <meta name="twitter:description" content="{{ description }}">
    <meta name="twitter:image" content="{{ logoUrl }}">
{% endblock %}

{% block jsonld %}
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebPage",
            "headline": "{{ title }}",
            "description": "{{ description }}",
            "image": "{{ logoUrl }}",
            "author": {
                "@type": "Organization",
                "name": "Zorglux",
                "logo": "{{ logoUrl }}",
                "url": "{{ absolute_url(path('public_index')) }}"
            },
            "publisher": {
                "@type": "Organization",
                "name": "Zorglux",
                "logo": {
                    "@type": "ImageObject",
                    "url": "{{ logoUrl }}"
                }
            },
            "url": "{{ path('app_register') }}"
        }
    </script>


    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "ItemList",
            "itemListElement": [
                {% for blog in blogs %}
                    {
                        "@type": "ListItem",
                        "position": {{ loop.index }},
                        "item": {
                            "@type": "BlogPosting",
                            "headline": "{{ blog.title }}",
                            "description": "{{ blog.description }}",
                            "articleBody": "{{ blog.content|striptags|replace({ "\n": " ", "\r": " " }) }}",
                            "url": "{{ path('blog_read', { slug: blog.slug }) }}",
                            "author": {
                                "@type": "Person",
                                "name": "{{ blog.author.username }}"
                            },
                            "image": "{{ blog.thumbnail }}"
                        }
                    }{% if not loop.last %},{% endif %}
                {% endfor %}
            ]
        }
    </script>

{% endblock %}

{% block body_header %}
    {% include '@common/navbar.html.twig' %}
{% endblock %}

{% block body_content %}

    {% set inputClasses = 'border-b rounded-sm outline-none focus:border-black p-1' %}
    {% set textErrorClasses = 'mt-1 text-xs text-red-500' %}
    {% set active = false %}

    <twig:Container>
        {{ form_start(form, {
            attr: {
                class: 'mt-5 p-5 shadow-lg border'
            }
        }) }}
        <h1 class="text-3xl mb-2">Deviens un membre de Zorglux</h1>

        <div class="mb-3 flex flex-col">
            {{ form_label(form.username, null, {
                label_attr: {
                    class: 'text-sm'
                }
            }) }}
            {{ form_widget(form.username, {
                attr: {
                    class: inputClasses,
                }
            }) }}
            {% if form.username.vars.errors|length > 0 %}
                <div class="{{ textErrorClasses }}">
                    {{ form_errors(form.username) }}
                </div>
            {% endif %}
        </div>
        <div class="mb-3 flex flex-col">
            {{ form_label(form.plainPassword, null, {
                label_attr: {
                    class: 'text-sm'
                }
            }) }}
            {{ form_widget(form.plainPassword, {
                attr: {
                    class: inputClasses,
                }
            }) }}
            {% if form.plainPassword.vars.errors|length > 0 %}
                <div class="{{ textErrorClasses }}">
                    {{ form_errors(form.plainPassword) }}
                </div>
            {% endif %}
        </div>
        <div class="mb-3 flex flex-col">
            {{ form_label(form.confirmPassword, null, {
                label_attr: {
                    class: 'text-sm'
                }
            }) }}
            {{ form_widget(form.confirmPassword, {
                attr: {
                    class: inputClasses,
                }
            }) }}
            {% if form.confirmPassword.vars.errors|length > 0 %}
                <div class="{{ textErrorClasses }}">
                    {{ form_errors(form.confirmPassword) }}
                </div>
            {% endif %}
        </div>

        <input type="hidden" name="_csrf_token"
               value="{{ csrf_token('authenticate') }}"
        >

        {% if not active %}
            <twig:Alert icon="fa-warning" classes="rounded mb-2" color="warning" variant="small" text="L'inscription a été désactivé temporairement jusqu'au 31 Juillet 2024. Merci de revenir après cette date." />
        {% endif %}

        <button class="bg-gray-800 text-white px-4 py-2 rounded w-full disabled:bg-gray-400" {% if not active %} disabled {% endif %} type="submit">
            S'inscrire
        </button>
        <div class="mt-2 text-center text-xs">
            <p>Déjà membre ?</p>
            <a href="{{ path('app_login') }}" class="text-gray-700 font-bold">Connecte toi.</a>
        </div>
        {{ form_end(form) }}

        <div class="py-5">
            <h2 class="text-lg">Lire les posts récents</h2>
            {% include '@public/partials/latest-posts.html.twig' with {
                grid: 'md:grid-cols-2'
            } %}
        </div>

        <div class="py-5">
            <h2 class="font-bold">Galeries photos</h2>
            {% include '@public/partials/gallery.html.twig' with {
                images: galleries,
                withMoreLink: true,
                grid: 'nothing'
            } %}
        </div>
    </twig:Container>
{% endblock %}
